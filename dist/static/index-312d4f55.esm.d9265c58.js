import{r as d,j as i,aQ as oe,aN as V,bb as ie,aR as ae,cL as ce,ac as Y,ae as ue,ai as le,a$ as de,e as R,a4 as pe,cM as me,ap as fe,cN as he,cO as ye,cP as ge,bH as be,c3 as Te,aj as G,a2 as F,aL as N,aD as Le,bV as Pe,aC as C,aB as w,aO as Ie,F as Oe,bj as Se,cQ as xe,aJ as M,a5 as Re,H as ve,ab as je,bn as $,cR as _e,cS as Ce,cT as we,cU as De,bh as B,U as Ee,cV as Fe,cF as $e,cG as Ae,bl as Ne,cW as Me,cX as Be,bZ as W,b$ as We,cY as ke,bQ as qe,bo as Ue,br as He,cZ as Ve,c_ as Ye,c$ as Ge,bR as Ke}from"./sanity.5e177576.js";import{u as Qe,c as k,b as Xe}from"./index-989e9e04.esm.48d1d2dc.js";import{P as ze}from"./PaneItem-c5593821.esm.9480a09d.js";import"./json-inspector.013338b0.js";function q(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),t.push.apply(t,r)}return t}function f(e){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?q(Object(t),!0).forEach(function(r){Ze(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):q(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function Ze(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const U=100,A=2e3,K={by:[{field:"_createdAt",direction:"desc"}]},Je={};function et(e,n){return e._id?G(e._id):"item-".concat(n)}function tt(e){return we(e).map(n=>{const t=n.draft||n.published;return f(f({},t),{},{hasPublished:!!n.published,hasDraft:!!n.draft})})}const nt=/\b_type\s*==\s*(['"].*?['"]|\$.*?(?:\s|$))|\B(['"].*?['"]|\$.*?(?:\s|$))\s*==\s*_type\b/;function rt(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=e.match(nt);if(!t)return null;const r=(t[1]||t[2]).trim().replace(/^["']|["']$/g,"");if(r[0]==="$"){const o=r.slice(1),u=n[o];return typeof u=="string"?u:null}return r}function st(e){return/^_type\s*==\s*['"$]\w+['"]?\s*$/.test(e.trim())}function ot(e){return e.map(n=>[it(n),(n.direction||"").toLowerCase()].map(t=>t.trim()).filter(Boolean).join(" ")).join(",")}function it(e){return e.mapWith?"".concat(e.mapWith,"(").concat(e.field,")"):e.field}function at(e,n){const t=e.by.map(r=>{if(r.mapWith)return r;const o=ct(n,r.field);return o?lt(o,"datetime")?f(f({},r),{},{mapWith:"dateTime"}):o.jsonType==="string"?f(f({},r),{},{mapWith:"lower"}):r:r});return t.every((r,o)=>r===e.by[o])?e:f(f({},e),{},{by:t})}function ct(e,n){const t=fe(n);let r=e;for(const o of t){if(!r)return;if(typeof o=="string"){r=ut(r,o);continue}if(!(he(o)||ye(o))||r.jsonType!=="array")return;const[s,a]=r.of||[];if(a||!s)return;if(!ge(s)){r=s;continue}const[p,y]=s.to||[];if(y||!p)return;r=p}return r}function ut(e,n){if(!("fields"in e))return;const t=e.fields.find(r=>r.name===n);return t?t.type:void 0}function lt(e,n){let t=e.type;for(;t;){if(t.name===n||!t.type&&t.jsonType===n)return!0;t=t.type}return!1}function dt(e){const{childItemId:n,error:t,filterIsSimpleTypeContraint:r,fullList:o,isActive:u,isLoading:s,items:a,layout:p,onListChange:y,onRetry:m,showIcons:l}=e,L=Y(),{collapsed:v}=be(),{collapsed:g,index:O}=Te(),[P,j]=d.exports.useState(!1);d.exports.useEffect(()=>{if(g)return;const c=setTimeout(()=>{j(!0)},0);return()=>{clearTimeout(c)}},[g]);const S=d.exports.useCallback(c=>{const b=G(c._id),h=n===b;return i(ze,{icon:l===!1?!1:void 0,id:b,pressed:!u&&h,selected:u&&h,layout:p,schemaType:L.get(c._type),value:c})},[n,u,p,L,l]),I=d.exports.useMemo(()=>{if(!P)return null;if(t)return i(F,{align:"center",direction:"column",height:"fill",justify:"center",children:i(N,{width:1,children:R(Le,{paddingX:4,paddingY:5,space:4,children:[i(Pe,{as:"h3",children:"Could not fetch list items"}),R(C,{as:"p",children:["Error: ",i("code",{children:t.message})]}),m&&i(w,{children:i(V,{icon:Ie,onClick:m,text:"Retry",tone:"primary"})})]})})});if(a===null)return i(F,{align:"center",direction:"column",height:"fill",justify:"center",children:i(Xe,{ms:300,children:R(Oe,{children:[i(Se,{muted:!0}),i(w,{marginTop:3,children:i(C,{align:"center",muted:!0,size:1,children:"Loading documents\u2026"})})]})})});if(!s&&a.length===0)return i(F,{align:"center",direction:"column",height:"fill",justify:"center",children:i(N,{width:1,children:i(w,{paddingX:4,paddingY:5,children:i(C,{align:"center",muted:!0,size:2,children:r?"No documents of this type":"No matching documents"})})})});const c=o&&a.length===A;return R(w,{padding:2,children:[a.length>0&&i(xe,{gap:1,getItemKey:et,items:a,renderItem:S,onChange:y},"".concat(O,"-").concat(g)),s&&i(M,{borderTop:!0,marginTop:1,paddingX:3,paddingY:4,children:i(C,{align:"center",muted:!0,size:1,children:"Loading\u2026"})}),c&&i(M,{marginTop:1,paddingX:3,paddingY:4,radius:2,tone:"transparent",children:R(C,{align:"center",muted:!0,size:1,children:["Displaying a maximum of ",A," documents"]})})]})},[t,r,o,y,s,a,m,S,P,g,O]);return i(Re,{overflow:v?void 0:"auto",children:I})}const Q=d.exports.memo(e=>{let{index:n,initialValueTemplates:t=[],menuItems:r=[],menuItemGroups:o=[],setLayout:u,setSortOrder:s,title:a}=e;const{features:p}=Qe(),y=d.exports.useMemo(()=>({setLayout:m=>{let{layout:l}=m;u(l)},setSortOrder:m=>{s(m)}}),[u,s]);return i(oe,{backButton:p.backButton&&n>0&&i(V,{as:ie,"data-as":"a",icon:ae,mode:"bleed"}),title:a,actions:i(ce,{initialValueTemplateItems:t,actionHandlers:y,menuItemGroups:o,menuItems:r})})});Q.displayName="DocumentListPaneHeader";const pt={result:null,error:!1},mt=e=>({result:{documents:e},loading:!1,error:!1}),ft=e=>({result:null,loading:!1,error:e}),ht=function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=new De,r=t.next.bind(t);return e.pipe(B(s=>({client:s.client,query:s.query,params:s.params})),Ee(Fe),$e(1),Ae()).pipe(Ne(s=>{const a=Me(s.client,s.query,s.params,n).pipe(B(mt),Be());return W($({loading:!0}).pipe(We(400),ke(a)),a)})).pipe(qe(pt),Ue((s,a)=>He($(ft(s)),W(Ve(window,"online"),t).pipe(Ye(1),Ge(a)))),Ke((s,a)=>f(f(f({},s),a),{},{onRetry:r})))};function yt(e){var n;const{apiVersion:t,defaultOrdering:r,filter:o,params:u,sortOrder:s}=e,a=ve(je),[p,y]=d.exports.useState(!1),m=d.exports.useRef(p),[l,L]=d.exports.useState(null),v=(l==null?void 0:l.error)||null,g=(l==null?void 0:l.loading)||l===null,O=l==null?void 0:l.onRetry,P=(n=l==null?void 0:l.result)==null?void 0:n.documents,j=d.exports.useMemo(()=>P?tt(P):null,[P]),S=d.exports.useMemo(()=>{const c=s==null?void 0:s.extendedProjection,b=["_id","_type"],h=b.join(","),T=r||(s==null?void 0:s.by)||[],_=p?A:U,D=T.length>0?T:K.by,x=ot(D);if(c){const E=b.concat(c).join(",");return["*[".concat(o,"] {").concat(E,"}"),"order(".concat(x,") [0...").concat(_,"]"),"{".concat(h,"}")].join("|")}return"*[".concat(o,"]|order(").concat(x,")[0...").concat(_,"]{").concat(h,"}")},[r,o,p,s]),I=d.exports.useCallback(c=>{let{toIndex:b}=c;g||m.current||b>=U/2&&(y(!0),m.current=!0)},[g]);return d.exports.useEffect(()=>{const c=p?T=>Boolean(T.result):()=>!0;L(T=>T?f(f({},T),{},{loading:!0}):null);const h=ht($({client:a,query:S,params:u}),{apiVersion:t,tag:"desk.document-list"}).pipe(_e(c)).subscribe(L);return()=>h.unsubscribe()},[t,a,p,S,u]),d.exports.useEffect(()=>{L(null),y(!1),m.current=!1},[o,u,s,t]),{error:v,fullList:p,handleListChange:I,isLoading:g,items:j,onRetry:O}}const H=[];function gt(e){const n=d.exports.useRef(e);return Ce(n.current,e)||(n.current=e),n.current}const It=d.exports.memo(function(n){const{childItemId:t,index:r,isActive:o,isSelected:u,pane:s,paneKey:a}=n,p=Y(),{name:y}=ue(),{defaultLayout:m="default",displayOptions:l,initialValueTemplates:L=H,menuItems:v,menuItemGroups:g,options:O,title:P}=s,{apiVersion:j,defaultOrdering:S=H,filter:I}=O,c=gt(O.params||Je),b=s.source,h=d.exports.useMemo(()=>rt(I,c),[I,c]),T=(l==null?void 0:l.showIcons)!==!1,[_,D]=k(h,"layout",m),[x,E]=k(h,"sortOrder",K),X=h&&x?at(x,p.get(h)):x,z=le(X),Z=st(I),{error:J,fullList:ee,handleListChange:te,isLoading:ne,items:re,onRetry:se}=yt({defaultOrdering:S,filter:I,params:c,sortOrder:z,apiVersion:j});return i(de,{name:b||y,children:R(pe,{currentMaxWidth:350,id:a,maxWidth:640,minWidth:320,selected:u,children:[me,i(Q,{index:r,initialValueTemplates:L,menuItems:v,menuItemGroups:g,setLayout:D,setSortOrder:E,title:P}),i(dt,{childItemId:t,error:J,filterIsSimpleTypeContraint:Z,fullList:ee,isActive:o,isLoading:ne,items:re,layout:_,onListChange:te,onRetry:se,showIcons:T})]})})});export{It as default};
